<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0">
    <meta name="format-detection" content="telephone=no" />
    <link rel="dns-prefetch" href="//static.matouapp.ymatou.com">
    <link rel="dns-prefetch" href="//staticontent.matouapp.ymatou.com">
    <link rel="dns-prefetch" href="//staticwap.ymatou.com">
    <link rel="shortcut icon" type="image/x-icon" href="http://staticontent.ymatou.com/ymtapp/matouapp.ico" />
    <title>洋码头-结算页</title>
    <script data-js-path="redraw.js">
     !(function(relWinth,relFontSize){var ua=navigator.userAgent,isIos=/iphone|ipad|ipod/i.test(ua),isMobile=/Mobile/i.test(ua);var meta=document.querySelector("[name=viewport]")||(function(){var _meta=document.createElement("meta");_meta.name="viewport"})(),content=meta.content||"",matchScale=content.match(/initial\-scale=([\d\.]+)/),matchWidth=content.match(/width=([\d\.]+)/),dpr=isIos?window.devicePixelRatio?Math.min(window.devicePixelRatio,3):1:1,docEl=document.documentElement,maxWidth=dpr*(docEl.dataset.mw||750),scale=1/dpr,tid;relWinth=relWinth||320;relFontSize=relFontSize||16;if(meta){if(matchScale){content=content.replace(/initial\-scale=([\d\.]+)/,"initial-scale="+scale).replace(/minimum\-scale=([\d\.]+)/,"minimum-scale="+scale).replace(/maximum\-scale=([\d\.]+)/,"maximum-scale="+scale)}else{content+=",initial-scale="+scale}meta.content=content}else{meta=doc.createElement("meta");meta.name="viewport";meta.content=content;docEl.firstElementChild.appendChild(meta)}var redraw=function(){var width=docEl.getBoundingClientRect().width;var fz=Math.min(width,maxWidth)/relWinth*relFontSize;docEl.style.fontSize=fz+"px"};if(isMobile){window.addEventListener("resize",function(){clearTimeout(tid);tid=setTimeout(redraw,300)},false);redraw()}else{docEl.style.fontSize="16px"}})(375,16);
    </script>
    <!-- build:css /styles/index.css-->
    <link rel="stylesheet" type="text/css" href="/styles/main.css">
    <!-- endbuild-->
    <style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide{display:none !important;}ng\:form{display:block;}</style>
</head>
<body>
    <section class="settle-container  ng-cloak" ng-controller="preOrderApp.controller.index">
        <!--收件地址-->
        <address class="address-wrapp ng-cloak" ng-click="openAddress()" ng-if="orderInfo.Orders">
            <h3 ng-if="orderInfo.Orders && orderInfo.Orders[0] && orderInfo.Orders[0].Address.AddressId" >收件人: {{orderInfo.Orders[0].Address.Addressee}} <span class="fr">{{orderInfo.Orders[0].Address.Mobile | phoneSecrecy}}</span></h3>
            <div ng-if="orderInfo.Orders && orderInfo.Orders[0] && orderInfo.Orders[0].Address.AddressId" >
                {{orderInfo.Orders[0].Address.Area}} {{orderInfo.Orders[0].Address.DetailAddress}}
            </div>
            <div class="add-address" ng-if="!(orderInfo.Orders && orderInfo.Orders[0] && orderInfo.Orders[0].Address.AddressId)">
                点击新增收货地址
            </div>
            <i class="icon-arrow-right"></i>
        </address>
        <div class="customs-wrapper ng-cloak" ng-if="isUploadIdCard && hasBonded">
            <div class="customs-title-wrapper">
            <!-- status change: fixed-->
                <div class="customs-title " overflow-fixed="fixed">
                    <i class="icon-customs"></i> 海关提示:购买保税商品需要提供收货人身份证号码
                </div>
            </div>
            <div class="customs-input" ng-class="{error:idCardError}">
                <input type="text" ng-model="idCard.no" name="" value="" placeholder="请输入收货人的身份证号码">
                <p class="msg-text ng-cloak">请输入收货人的身份证号码</p>
            </div>
        </div>
        <!--商品列表-->
        <div class="buyer-list-wrapp ng-cloak">
            <div class="buyer-item" ng-repeat="i in orderInfo.Orders">
                <div class="buyer-item-hd">
                    <strong>{{i.SellerName}}</strong>
                </div>
                <ul class="buyer-item-bd pro-list">
                    <li ng-repeat="p in i.Products">
                        <div class="pic">
                            <div class="pic-carrier" ng-style="{'background-image':'url('+p.PictureUrl+')'}">

                            </div>
                        </div>
                        <div class="info">
                            <h4>{{p.ProductName}}</h4>
                            <p ng-repeat="catalogProp in p.CatalogPropertyList">{{catalogProp.Property}} : <b>{{catalogProp.PropertyAttribute}}</b></p>
                            <p>
                                <span class="pro-flag local-return" ng-if="1"><i class="icon-local-return"></i>本土退货</span>
                                <span class="pro-flag xloboBoned" ng-if="p.CatalogStatus==5"><i class="icon-beihai-bonded"></i>贝海保税</span>
                                <span class="pro-flag xloboBoned" ng-if="p.CatalogStatus==3"> <i class="icon-beihai-directMail"></i>贝海直邮</span>
                                <span class="pro-flag xloboBoned" ng-if="p.CatalogStatus==4"> <i class="icon-seller-bonded"></i>卖家保税</span>
                                <span class="pro-flag xloboBoned" ng-if="p.CatalogStatus==2"> <i class="icon-zhiyou"></i>直邮</span>
                            </p>
                            <div class="attr">
                                <strong>&yen;{{p.QuotePrice.toFixed(2)}}</strong>
                                <del ng-if="p.OriginPrice && p.OriginPrice != p.QuotePrice">&yen;{{p.OriginPrice.toFixed(2)}}</del>
                            </div>
                            <span class="num">x{{p.ProductNumber}}</span>
                        </div>
                    </li>
                </ul>
                <div class="settle-count">
                    <div><b>共 2 件商品</b> 合计：<span class="price price-num">&yen;<strong>140</strong>.00</span></div>
                    <div class="freight-total">(含运费：<span class="price-num">&yen;<strong>40</strong>.00</span>)</div>
                </div>
                <div class="buyer-ft">
                    <!--优惠-->
                    <div class="discount-wrapper ng-cloak" ng-if="i.Promotion.CanUseCoupon||i.Promotion.CanUseGift||i.Promotion.CanUseFreeCard">
                        <div class="discount-hd">
                            我使用的优惠
                        </div>
                        <ol class="discount-list" ng-init="canUseGift(i)">
                            <!--stauts change : disabled -->
                            <li class="gift-wrapper" ng-if="i.Promotion.CanUseGift" ng-class="{'disabled':i.Promotion.CanUseGift && i.usedGift==0}" ng-click="useGift(i)" ng-init="i.PromotionUsed.UseGiftAmount = 0">
                                <label class="fl"><i class="icon-checkBox" ng-class="{'icon-checkBox-selected':i.PromotionUsed.UseGiftAmount}"></i></label>
                                <span class="label">
                                    红包 金额 &yen;{{i.usedGift}}
                                </span>
                                <div class="sub-label">
                                    最多抵扣本次支付金额的50%
                                </div>
                            </li>
                            <li ng-if="i.Promotion.CanUseCoupon" >
                                <!--stauts change : selected-->
                                <label ng-click="switchCoupon(i)"><i class="icon-checkBox" ng-class="{'icon-checkBox-selected':i.PromotionUsed.UseCouponCode && !i.PromotionUsed.inputCouponCode}"></i></label>
                                <span class="label">优惠券</span>
                                <span class="coupon-select" ng-click="openUserCoupon(i)">{{i.useDiscount||'选择优惠券'}} <i class="icon-arrow-down"></i></span>
                            </li>
                            <li ng-if="i.Promotion.CanUseCoupon" ng-click1="openInputCoupon(i)">
                                <label><i class="icon-checkBox" ng-class="{'icon-checkBox-selected':i.PromotionUsed.UseCouponCode && i.PromotionUsed.inputCouponCode}"></i></label>
                                <span class="label">优惠码</span>
                                <input class="coupon-code" type="text" name="" value="" placeholder="输入优惠码" ng-model="coupon.code" ng-blur="confirmInputCoupon(i)">
                            </li>
                        </ol>
                    </div>
                    <!--留言-->
                    <div class="leaveMessage">
                        <label for="">留言:</label>
                        <input ng-model="leaveMessage.content" placeholder="说说~"/>
                    </div>
                    <div class="declare">
                        <a ng-click="">我已授权委托洋码头申报海关购买海外商品</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="preorder-no-result" ng-if="load && ((orderInfo && !orderInfo.Orders[0]) || !orderInfo)">
            <div class="no-result-bg"></div>
            <div calss="no-result-text">
                <p>哈尼~非常抱歉</p>
                <p>该商品状态已变更，请返回重试。</p>
            </div>
        </div>
        <div class="settle-tools-wrapper">
            <div class="settle-tools">
                <div class="text">
                   <!--  <div>
                       共计 {{productNumber || 0}} 件商品,合计:<strong>&yen;{{ orderInfo.TotalPrice || 0 }}</strong>
                   </div>
                   <div class="a">
                       <small>含运费: &yen;{{orderInfo.TotalFreight || 0 }}   优惠扣除: - &yen;{{discountPrice}} </small>
                   </div> -->
                    <span class="fl total">共 {{productNumber || 0}} 件</span>
                    <strong>需支付:{{ orderInfo.TotalPrice || 0 }}</strong>
                </div>
                <button class="btn btn-primary" type="button" ng-click="saveOrder()" ng-class="{'btn-invalid':!canSubmint}">立即购买</button>
            </div>
        </div>

        <div class="dialog-mask ng-cloak" ng-class="{open:maskOpen}" ng-click="closeMask()"></div>
        <!--输入优惠券-->
        <div class="dialog ng-cloak" ng-class="{open:validateStep == 1}">
            <div class="dialog-content">
                <div class="title">
                    输入优惠券
                </div>
                <div class="input-group">
                    <input class="inp" type="text" name="" value="" ng-model="coupon.code">
                </div>
                <div class="btn-group">
                    <div class="btn-group-col_2">
                        <button class="btn btn-full" type="button" ng-click="closeMask()">取消</button>
                    </div>
                    <div class="btn-group-col_2">
                        <button class="btn btn-primary btn-full" type="button" ng-click="confirmInputCoupon()">确定</button>
                    </div>
                </div>
            </div>
        </div>
        <!--绑定优惠券-->
        <div class="dialog ng-cloak" ng-class="{open:validateStep == 2}">
            <div class="dialog-content">
                <div class="title">
                    验证手机号码
                </div>
                <div class="input-group">
                    <input class="inp" type="text" name="" value="" ng-model="phoneNumber" placeholder="手机号码">
                </div>
                <p class="assist-msg">手机验证后将与您的账号绑定，请使用您本人的手机号码</p>
                <div class="input-group vliadCode">
                    <input class="inp" type="number" name="" value="" ng-model="coupon.validCode" placeholder="输入验证码" maxlength="6">
                    <button class="btn" ng-class="{'btn-primary':!coupon.btnStatus}" type="button" ng-click="resend()">{{coupon.btnTxt || '发送验证码'}}</button>
                </div>
                <div class="btn-group">
                    <div class="btn-group-col_2">
                        <button class="btn btn-full" type="button" ng-click="closeMask()">取消</button>
                    </div>
                    <div class="btn-group-col_2">
                        <button class="btn btn-primary btn-full" type="button" ng-click="completeValidate()">确定</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="dialog ng-cloak dialog-select-wrapper" ng-class="{open:couponOpen}">
            <div class="dialog-content">
                <div class="title">
                    共有{{couponsList.length || 0}}张优惠券
                </div>
                <div class="beat-loading" ng-if="couponLoading"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>
                <ul class="my-discount-list">
                    <!--statuc change: disabled-->
                    <li class="my-discount-item" ng-repeat="i in couponsList" ng-click="selectCoupon(i)">
                        <h3>满{{i.CouponOrderValue}}{{(i.UseType==1?"抵":"返")}}{{i.CouponValue}}</h3>
                        <p>有效期至 {{i.ValidEnd}}</p>
                    </li>
                </ul>
                <div class="my-discount-msg" ng-if="!couponLoading && !(couponsList&&couponsList.length)">没有可使用的优惠券~~</div>
            </div>
        </div>
        <div class="address-mask-fix ng-cloak" ng-class="{open:!!addressState}" ng-click="closeAddressState()" disabled-scroll="">
            <div class="address-mask-close">
                <i class="icon-arrow-right"></i>
            </div>
        </div>

        <!--地址管理-->
        <div class="pt-page address-edit-wrapper ng-cloak" switch-page="addressState == 1">
            <div class="address-edit-inner">
                <ul class="address-edit-list">
                    <li ng-repeat="add in AddressService.list | orderBy:'AddressId'" ng-class="{selected:add.IsDefault}">
                         <label ng-click="setDefault(add)"><i class="icon-checkBox-selected2" ></i></label>
                        <div class="text-area"  ng-click="editAddress(add.AddressId)">
                            <h5>{{add.Recipient}} {{add.Mobile}}</h5>
                            <div>
                                {{add.Address1}} {{add.Details}}
                            </div>
                            <i class="icon-arrow-right"></i>
                        </div>

                    </li>

                </ul>
                <div class="btn-group">
                    <button class="btn btn-primary btn-full" ng-click="insterAddress()">新增地址</button>
                </div>
            </div>
        </div>
        <!---->
        <div class="pt-page address-edit-wrapper ng-cloak" switch-page="addressState == 2">
            <div class="address-edit-inner">
                <div class="address-form">
                    <p class="input-group">
                        <input type="text" value="" ng-model="AddressService.item.Recipient" placeholder="收货人"></p>
                    <p class="txt_msg">请务必填写真实的收货人姓名，海关清关时将核对姓名</p>
                    <p class="input-group">
                        <input type="text" value="" ng-model="AddressService.item.Mobile" placeholder="手机号码"></p>
                        <p class="input-group three-section">
                         <span class="">
                            <select ng-model="AddressService.item.ProvinceName" ng-options="act.name as act.name for act in AddressService.cityObj[0]" ng-change="AddressService.selectCity()" >
                                <option value="">选择省份</option>
                            </select>
                        </span>
                        <span class="">
                            <select ng-model="AddressService.item.CityName" ng-options="act.name as act.name for act in AddressService.selectCityObj" ng-change="AddressService.areaCity()" >
                                <option value="" >选择城市</option>
                            </select>
                        </span>
                        <span class="">
                            <select ng-model="AddressService.item.DistrictName" ng-options="act.name as act.name for act in AddressService.selectDistrictObj">
                                <option value="">选择县区</option>
                            </select>
                        </span>
                    </p>
                    <p class="input-group">
                        <input type="text" value="" ng-model="AddressService.item.Details" placeholder="详细地址"/></p>
                    <p class="input-group">
                        <input type="text" value="" ng-model="AddressService.item.PostCode" placeholder="邮政编号"/></p>
                    <!-- <p class="input-group"  ng-if="!AddressService.hasEmail">
                        <input type="email" value="" ng-model="AddressService.item.Email" placeholder="电子邮件地址（e-mail）"/></p> -->
                    <p class="input-group selectDefault">
                        <label class="label" ng-click="AddressService.item.IsDefault = !AddressService.item.IsDefault">
                        <i class="icon-checkBox-selected2" ng-class="{'selected':AddressService.item.IsDefault}" ></i>
                        设置为默认收货地址</label>
                    </p>
                </div>
                <div class="btn-group" ng-if="!AddressService.item.AddressId">
                    <button class="btn btn-primary btn-full" ng-click="saveAddress()">保存</button>
                </div>
                <div class="btn-group" ng-if="AddressService.item.AddressId">
                    <div class="btn-group-col_2">
                        <button type="button" class="btn btn-border-primary btn-white btn-full" ng-click="deleteAddress(AddressService.item.AddressId)">删除</button>
                    </div>
                    <div class="btn-group-col_2">
                        <button class="btn btn-primary btn-full" ng-click="saveAddress()">保存</button>
                    </div>
                </div>

            </div>
        </div>

        <div class="ymtui-dialog-mask"></div>
    </section>
    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i, o) {
          w['YmatouAnalyticsobject'] = o;
          w[o] = w[o] || function () {
            (w[o].q = w[o].q || []).push(arguments)
          }

          w[l] = w[l] || [];
          w[l].push({
            'gtm.start': new Date().getTime(),
            event: 'gtm.js'
          });
          var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
          j.async = true;
        j.src = '//www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-P26VLJ', '_dc_');
    </script>
    <!-- End Google Tag Manager -->
    <script src="http://static.jyh.ymatou.com/commons/js/jweixin.2015110601.js"></script>
    <script src="http://static.jyh.ymatou.com/commons/js/ymtapi.2015110601.js?wxAutoInit=1"></script>
    <!-- build:js /scripts/vendor/zepto,angular.js -->
    <script src="/scripts/vendor/zepto.min.js"></script>
    <script src="/scripts/vendor/angular.min.js"></script>
    <!-- endbuild -->
    <!-- build:js /scripts/settle-app_min.js -->
    <script src="/scripts/settle_app.js"></script>
    <!-- endbuild -->
</body>
</html>
